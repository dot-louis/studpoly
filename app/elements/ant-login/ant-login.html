<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/firebase-element/firebase-auth.html">

<dom-module id="ant-login">
  <template>
    <firebase-auth id="firebaseLogin"
        user="{{user}}"
        status-known="{{statusKnown}}"
        location="https://project-ant.firebaseio.com"
        provider="facebook"
        on-error="errorHandler"
        on-user-created="userSuccessHandler"
        on-password-changed="userSuccessHandler"
        on-password-reset="userSuccessHandler"
        on-user-removed="userSuccessHandler"></firebase-auth>

    <button on-tap="login" hidden$="{{computeLoginHidden(statusKnown, user)}}">Login with facebook</button>
    <button on-tap="logout" hidden$="{{computeLogoutHidden(statusKnown, user)}}">Logout</button>

    <br>
    <div id="message">[[message]]</div>
    <br>

    <h3>Login status:</h3>
    <p>{{computeLoginStatus(statusKnown, user)}}</p>

    <h3>User ID:</h3>
    <pre>{{user.uid}}</pre>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'ant-login',

    properties: {
        message: {
          type: String,
          value: ''
        },
        user: {
            type: Object,
            value: null
        },
        statusKnown: {
            type: Boolean
        }
    },

    login: function() {
        console.log(this);
        console.log(this.$);
      this.$.firebaseLogin.login();
    },

    logout: function() {
      this.$.firebaseLogin.logout();
    },

    errorHandler: function(e) {
      this.message = 'Error: ' + e.detail.message;
    },

    userSuccessHandler: function(e) {
      this.message = e.type + ' success!';
    },

    computeLoginHidden: function(statusKnown, user) {
      return !statusKnown || !!user;
    },

    computeLogoutHidden: function(statusKnown, user) {
      return !statusKnown || !user;
    },

    computeLoginStatus: function(statusKnown, user) {
      if (statusKnown && user) {
        return 'Logged in';
      }

      if (statusKnown) {
        return 'Logged out';
      }

      return 'Unknown (checking status...)';
    }
  });
</script>
